# 中断時の状況と残タスク

## 現在までの進捗

*   **階層化メニューの実装:** `menu.yaml` を使用して、メニューを階層化しました。
*   **`setup.sh` の作成:** 初回セットアップスクリプト `setup.sh` を作成しました。これにより、必要なPythonモジュール (`PyYAML`, `Flask`) のインストールと、`menu` コマンドの作成が行われます。
*   **`main.py` の `menu.py` へのリネーム:** メインのPythonスクリプトを `main.py` から `menu.py` に変更しました。
*   **GitHub CLI (`gh`) インストール機能の追加:** `menu.yaml` に `gh` インストールメニューを追加し、`menu.py` にインストール処理を実装しました。
*   **Samba共有削除機能の追加:** `menu.yaml` にSamba共有削除メニューを追加し、`menu.py` に `smb.conf` から共有を読み込み、削除する機能を実装しました。
*   **Webメニュー (`webmenu.py`) の作成:**
    *   Flask を使用してWebサーバーを構築しました。
    *   `menu.yaml` からメニューデータを読み込み、JSON APIとして提供します。
    *   `menu.py` の `execute_function` をWebから呼び出し、その出力をWebレスポンスとして返すAPIエンドポイントを作成しました。
    *   `templates/index.html` を作成し、Webブラウザでメニューを表示し、操作できるようにしました。
*   **`menu.py` のWeb対応:** `execute_function` が標準出力をキャプチャし、`input()` の代わりに `input_data` を受け取るように修正しました。

## 残りのタスク

1.  **`menu.py` のCLIインタラクティブ入力の再調整:**
    *   `samba_install_and_share` および `samba_delete_share` 関数は、Webからの呼び出しを想定して `input_data` を受け取るように変更されました。
    *   CLIからこれらの関数をインタラクティブに実行する場合（`menu.py` を直接実行する場合）、ユーザーからの入力（例: 共有パス、削除する共有の選択）をどのように受け取るかを再検討し、実装する必要があります。現状では、`input_data` が提供されない場合、エラーメッセージが表示されるか、処理が中断されます。
    *   特に `samba_delete_share` のCLI版では、`curses` を使った共有選択メニューを再導入するか、別のインタラクティブな選択方法を検討する必要があります。

2.  **`menu.py` のCLI引数解析の強化:**
    *   `samba_delete_share` のエラーメッセージで示唆されている `--share_name <共有名>` のようなCLI引数による直接実行のサポートは、`menu.py` の `main` 関数で実装されていません。必要であれば、`argparse` などのライブラリを使用して引数解析を実装する必要があります。

3.  **Webメニューのセキュリティ強化:**
    *   現状のWebメニューは、リモートからシェルコマンドを実行できるため、セキュリティリスクがあります。本番環境での使用を想定する場合、認証、認可、入力値の検証などのセキュリティ対策を強化する必要があります。

4.  **エラーハンドリングとユーザーフィードバックの改善:**
    *   各機能で発生しうるエラーに対するより詳細なハンドリングと、ユーザーへの分かりやすいフィードバック（特にWebUI上でのエラー表示）を検討する必要があります。

---
# 中断時の状況と残タスク

## 現在までの進捗

*   **`readme.md` の作成と更新:** プロジェクト概要、インストール方法（Git、クローン、`setup.sh`、メニュー実行）、リポジトリ更新方法を記載しました。
*   **`setup.sh` の修正:**
    *   `python3-pip` がインストールされていない場合に自動でインストールする処理を追加しました。
    *   `menu` および `update` スクリプトの生成時に、変数が正しく展開されるようにヒアドキュメントの記述を修正しました。
*   **`screen` 操作メニューの追加:** `menu.yaml` と `menu.py` に、`screen` セッションの開始と再開のメニューを追加しました。
*   **Code Server 操作メニューの追加:** `menu.yaml` と `menu.py` に、Code Serverのインストール、手動起動、サービス登録・起動、サービス停止・削除、パスワード表示・設定のメニューを追加しました。
*   **Code Server 外部アクセス設定:** `menu.py` でCode Serverを手動起動する際に、`--bind-addr 0.0.0.0:8080` オプションを追加し、外部からの接続を受け付けるようにしました。
*   **`menu.py` のf-string構文エラー修正:** Code Serverパスワード表示機能のf-string構文エラーを修正しました。
*   **VS Code Remote - SSH Server 依存関係インストール機能の追加:** `menu.yaml` と `menu.py` に、VS Code Remote - SSH Serverが動作するために必要な依存関係をインストールするメニューを追加しました。

## 残りのタスク

1.  **`menu.py` のCLIインタラクティブ入力の再調整:**
    *   `samba_install_and_share` および `samba_delete_share` 関数は、Webからの呼び出しを想定して `input_data` を受け取るように変更されました。
    *   CLIからこれらの関数をインタラクティブに実行する場合（`menu.py` を直接実行する場合）、ユーザーからの入力（例: 共有パス、削除する共有の選択）をどのように受け取るかを再検討し、実装する必要があります。現状では、`input_data` が提供されない場合、エラーメッセージが表示されるか、処理が中断されます。
    *   特に `samba_delete_share` のCLI版では、`curses` を使った共有選択メニューを再導入するか、別のインタラクティブな選択方法を検討する必要があります。
2.  **`menu.py` のCLI引数解析の強化:**
    *   `samba_delete_share` のエラーメッセージで示唆されている `--share_name <共有名>` のようなCLI引数による直接実行のサポートは、`menu.py` の `main` 関数で実装されていません。必要であれば、`argparse` などのライブラリを使用して引数解析を実装する必要があります。
3.  **Webメニューのセキュリティ強化:**
    *   現状のWebメニューは、リモートからシェルコマンドを実行できるため、セキュリティリスクがあります。本番環境での使用を想定する場合、認証、認可、入力値の検証などのセキュリティ対策を強化する必要があります。
4.  **エラーハンドリングとユーザーフィードバックの改善:**
    *   各機能で発生しうるエラーに対するより詳細なハンドリングと、ユーザーへの分かりやすいフィードバック（特にWebUI上でのエラー表示）を検討する必要があります。
5.  **Code Serverのパスワード設定のCLIインタラクティブ化:**
    *   `code_server_set_password` 関数でCLIから実行した場合に `input()` を使用しているが、Webからの実行とCLIからの実行で統一的な入力方法を検討する必要がある。
6.  **Code Serverの自動起動設定の確認と説明:**
    *   `sudo systemctl enable --now code-server@$USER` の `$USER` が正しく展開されるか、またはユーザーに `$USER` を適切なユーザー名に置き換えるよう促す説明が必要。
7.  **ファイアウォール設定の自動化または説明の追加:**
    *   Code Serverの外部アクセスを可能にするために、8080ポートのファイアウォール開放が必要であることを `readme.md` またはメニュー内で説明するか、メニューから自動で設定できるようにする。
